SELECT C.CUSTOMER_ID, C.LAST_NAME, C.ADR_CITY,C.ADR_STATE,
((TOTAL_VISIT/TOTAL_WEEK * TOTAL_REVENUE/TOTAL_VISIT) * 52 * 10) AS LTV
FROM
(
  ( SELECT
    CEIL(TRUNC(MAX(EVENT_TIME))-TRUNC(MIN(EVENT_TIME))/7) TOTAL_WEEK
    /*TimeStamp format is "YYYY-MM-DD"T"HH24:MI:SS.FF3"Z""*/
    FROM
    SITE_VISIT
  ) AS TW,
  ( SELECT COUNT(PAGE_ID) TOTAL_VISIT, CUSTOMER_ID
    FROM
    SITE_VISIT
    GROUP BY CUSTOMER_ID
  ) AS TV,
  INNER JOIN
  (
    SELECT SUM(TOTAL_AMOUNT) TOTAL_REVENUE, CUSTOMER_ID
    FROM
    ORDER
    GROUP BY CUSTOMER_ID
  ) AS TE
  ON TV.CUSTOMER_ID=TE.CUSTOMER_ID
) AS CUST_LTV
INNER JOIN
CUSTOMER C 
ON C.CUSTOMER_ID=CUST_LTV.CUSTOMER_ID
